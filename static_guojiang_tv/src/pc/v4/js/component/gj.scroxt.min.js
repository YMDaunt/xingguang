!(function (t, e) { if (typeof exports === 'object' && typeof module === 'object')module.exports = e(); else if (typeof define === 'function' && define.amd)define([], e); else { var r = e(); for (var i in r)(typeof exports === 'object' ? exports : t)[i] = r[i] } }(typeof self !== 'undefined' ? self : this, function () { return (function (t) { function e (i) { if (r[i]) return r[i].exports; var n = r[i] = {i: i, l: !1, exports: {}}; return t[i].call(n.exports, n, n.exports, e), n.l = !0, n.exports } var r = {}; return e.m = t, e.c = r, e.d = function (t, r, i) { e.o(t, r) || Object.defineProperty(t, r, {configurable: !1, enumerable: !0, get: i}) }, e.n = function (t) { var r = t && t.__esModule ? function () { return t.default } : function () { return t }; return e.d(r, 'a', r), r }, e.o = function (t, e) { return Object.prototype.hasOwnProperty.call(t, e) }, e.p = '/dist/', e(e.s = 7) }([function (t, e, r) { 'use strict'; var i = (function () { return window.requestAnimationFrame || window.webkitRequestAnimationFrame || window.mozRequestAnimationFrame || function (t) { window.setTimeout(t, 1e3 / 60) } }()); e.a = i }, function (t, e, r) { 'use strict'; var i = (function () { return window.cancelAnimationFrame || window.mozCancelAnimationFrame || window.clearTimeout }()); e.a = i }, function (t, e, r) { 'use strict'; function i (t, e) { return Object(n.a)(t) ? window.getComputedStyle(t, null).getPropertyValue(e) : typeof t === 'string' && document.querySelector(t) ? window.getComputedStyle(document.querySelector(t), null).getPropertyValue(e) : void 0 }e.a = i; var n = r(5) }, function (t, e, r) { 'use strict'; function i (t) { var e = document.createElement('style'); var r = document.head || document.getElementsByTagName('head')[0]; if (e.type = 'text/css', e.styleSheet) { var i = function () { try { e.styleSheet.cssText = t } catch (t) { console.error(t) } }; e.styleSheet.disabled ? setTimeout(i, 10) : i() } else { var n = document.createTextNode(t); e.appendChild(n) }r.appendChild(e) }e.a = i }, function (t, e, r) { 'use strict'; var i = (function () { function t (t) { t.target, t.data, t.speed; this.options = {target: '', data: [], speed: 5}, this.extendOpt(arguments[0]), this.targetElement = document.querySelector(this.options.target) } return t.prototype.extendOpt = function (t) { var e = this; for (var r in t)t.hasOwnProperty(r) && (e.options[r] = t[r]) }, t.prototype.createElement = function (t) { void 0 === t && (t = ''); var e = []; var r = document.querySelector('.scroxt-wrapper'); r || (r = document.createElement('div'), r.className = 'scroxt-wrapper', this.targetElement = document.querySelector(this.options.target), this.targetElement.appendChild(r)); for (var i = 0, n = this.options.data.length; i < n; i++) { var a = document.createElement('div'); a.className = t; var o = this.options.data[i]; a.innerHTML = o, r.appendChild(a), e.push(a) } return e }, t }()); e.a = i }, function (t, e, r) { 'use strict'; function i (t) { return !(!t || !t.nodeType) && t.nodeType === 1 }e.a = i }, function (t, e, r) { 'use strict'; function i (t) { if (Object(n.a)(t))t.parentNode.removeChild(t); else if (typeof t === 'string' && document.querySelector(t)) { var e = document.querySelector(t); e.parentNode.removeChild(e) } else console.log('参数错误') }e.a = i; var n = r(5) }, function (t, e, r) { 'use strict'; Object.defineProperty(e, '__esModule', {value: !0}); var i = r(8); var n = r(9); var a = r(10); var o = r(12); var s = {}; Object.defineProperty(s, 'Horizontal', {value: i.a, writable: !1, enumerable: !1, configurable: !1}), Object.defineProperty(s, 'Vertical', {value: n.a, writable: !1, enumerable: !1, configurable: !1}), Object.defineProperty(s, 'Barrage', {value: a.a, writable: !1, enumerable: !1, configurable: !1}), Object.defineProperty(s, 'Live', {value: o.a, writable: !1, enumerable: !1, configurable: !1}), window.scroxt = s, e.default = s }, function (t, e, r) { 'use strict'; var i = r(4); var n = r(0); var a = r(1); var o = r(2); var s = r(6); var c = r(3); var h = this && this.__extends || (function () { var t = Object.setPrototypeOf || {__proto__: []} instanceof Array && function (t, e) { t.__proto__ = e } || function (t, e) { for (var r in e)e.hasOwnProperty(r) && (t[r] = e[r]) }; return function (e, r) { function i () { this.constructor = e }t(e, r), e.prototype = r === null ? Object.create(r) : (i.prototype = r.prototype, new i()) } }()); var p = (function (t) { function e (e) { var r = e.target; var i = e.data; var n = e.speed; var a = e.gap; var o = void 0 === a ? 10 : a; var s = t.call(this, {target: r, data: i, speed: n}) || this; return s.sumWidth = 0, s.distance = 0, s.targetWidth = 0, s.divWrapElementWidth = 0, s.targetElementBorderWidth = 0, s.ST = 0, s.scroxtGap = o, s.createStyle(), s.init(), s } return h(e, t), e.prototype.createStyle = function () { Object(c.a)('\n            .scroxt-wrapper::after{\n                display: block;\n                content: "";\n                clear: both;\n            }\n            .scroxt-horizontal{\n                float: left;\n                margin-right: ' + this.scroxtGap + 'px;\n                white-space: nowrap;\n                box-sizing: border-box;\n            }\n        ') }, e.prototype.init = function () { if (this.targetWidth = parseFloat(Object(o.a)(this.targetElement, 'width')), this.targetElementBorderWidth = parseFloat(Object(o.a)(this.targetElement, 'border-width')), this.createHorizontal(), this.divWrapElementWidth / 2 < this.targetWidth) { Object(s.a)('.scroxt-wrapper'); var t = this.createElement('scroxt-horizontal'); this.divWrapElementWidth = this.computeWidth(t) + t.length * this.scroxtGap; var e = document.querySelector('.scroxt-wrapper'); return e.style.width = this.divWrapElementWidth + 'px', void (e.style.marginLeft = '0px') } this.STRun() }, e.prototype.createHorizontal = function () { Object(s.a)('.scroxt-wrapper'); var t = this.createElement('scroxt-horizontal'); var e = this.createElement('scroxt-horizontal'); var r = t.concat(e); this.divWrapElementWidth = this.computeWidth(r) + r.length * this.scroxtGap; var i = document.querySelector('.scroxt-wrapper'); return i.style.width = this.divWrapElementWidth + 'px', i }, e.prototype.computeWidth = function (t) { for (var e = 0, r = 0, i = t.length; r < i; r++)e += Math.ceil(+Object(o.a)(t[r], 'width').replace('px', '')); return e }, e.prototype.STRun = function () { this.divWrapElementWidth / 2 < this.targetWidth || (this.STMove(), this.ST = Object(n.a)(function () { this.STRun() }.bind(this))) }, e.prototype.STMove = function () { var t = document.querySelector('.scroxt-wrapper'); var e = t.getBoundingClientRect(); var r = e.left + (e.right - e.left) / 2; var i = this.targetElement.getBoundingClientRect(); if (this.options.speed < 0) { var n = i.left + this.targetElementBorderWidth; r + 0.1 * this.options.speed <= n && (this.distance = 0, t = this.createHorizontal(), t.style.left = '0px', t.style.marginLeft = '0px') } else { var a = i.right - 2 * this.targetElementBorderWidth; r + 0.1 * this.options.speed >= a && (this.distance = -this.divWrapElementWidth + this.targetWidth, t = this.createHorizontal(), t.style.right = '0px', t.style.marginRight = '0px') }t.style.transform = 'translate3d(' + this.distance + 'px, 0px, 0px)', t.style.webkitTransform = 'translate3d(' + this.distance + 'px, 0px, 0px)', this.distance += 0.1 * this.options.speed }, e.prototype.stopMove = function () { Object(a.a)(this.ST), this.ST = 0 }, e.prototype.startMove = function () { this.ST === 0 && this.STRun() }, e }(i.a)); e.a = p }, function (t, e, r) { 'use strict'; var i = r(4); var n = r(0); var a = r(1); var o = r(2); var s = r(6); var c = r(3); var h = this && this.__extends || (function () { var t = Object.setPrototypeOf || {__proto__: []} instanceof Array && function (t, e) { t.__proto__ = e } || function (t, e) { for (var r in e)e.hasOwnProperty(r) && (t[r] = e[r]) }; return function (e, r) { function i () { this.constructor = e }t(e, r), e.prototype = r === null ? Object.create(r) : (i.prototype = r.prototype, new i()) } }()); var p = (function (t) { function e (e) { var r = t.call(this, e) || this; return r.targetHeight = 0, r.divWrapElementHeight = 0, r.distance = 0, r.ST = 0, r.targetHeight = parseFloat(Object(o.a)(r.targetElement, 'height')), r.createStyle(), r.startRun(), r } return h(e, t), e.prototype.startRun = function () { if (this.divWrapElementHeight = this.createVertical(), this.targetHeight > this.divWrapElementHeight / 2) return Object(s.a)('.scroxt-wrapper'), void this.createElement('scroxt-vertical'); this.STRun() }, e.prototype.createStyle = function () { Object(c.a)('\n            .scroxt-vertical{\n                box-sizing: border-box;\n            }\n        ') }, e.prototype.createVertical = function () { Object(s.a)('.scroxt-wrapper'); var t = this.createElement('scroxt-vertical'); var e = this.createElement('scroxt-vertical'); return this.divWrapElement = document.querySelector('.scroxt-wrapper'), this.computeHeight(t.concat(e)) }, e.prototype.computeHeight = function (t) { for (var e = 0, r = 0, i = t.length; r < i; r++)e += Math.ceil(+Object(o.a)(t[r], 'height').replace('px', '')); return e }, e.prototype.STRun = function () { this.targetHeight > this.divWrapElementHeight / 2 || (this.STMove(), this.ST = Object(n.a)(function () { this.STRun() }.bind(this))) }, e.prototype.STMove = function () { this.options.speed < 0 ? this.distance <= -this.divWrapElementHeight / 2 && (this.createVertical(), this.distance = 0) : this.distance >= this.targetHeight - this.divWrapElementHeight / 2 && (this.createVertical(), this.distance = this.targetHeight - this.divWrapElementHeight), this.divWrapElement.style.transform = 'translate3d(0px, ' + this.distance + 'px, 0px)', this.divWrapElement.style.webkitTransform = 'translate3d(0px, ' + this.distance + 'px, 0px)', this.distance += 0.1 * this.options.speed }, e.prototype.stopMove = function () { Object(a.a)(this.ST), this.ST = 0 }, e.prototype.startMove = function () { this.ST === 0 && this.STRun() }, e }(i.a)); e.a = p }, function (t, e, r) { 'use strict'; var i = r(0); var n = r(1); var a = r(2); var o = r(11); var s = r(3); var c = this && this.__extends || (function () { var t = Object.setPrototypeOf || {__proto__: []} instanceof Array && function (t, e) { t.__proto__ = e } || function (t, e) { for (var r in e)e.hasOwnProperty(r) && (t[r] = e[r]) }; return function (e, r) { function i () { this.constructor = e }t(e, r), e.prototype = r === null ? Object.create(r) : (i.prototype = r.prototype, new i()) } }()); var h = (function (t) { function e (e) { var r = e.video; var i = e.dataTime; var n = t.call(this) || this; return n.videoEnd = !1, n.barrageWrap = [], n.readyShowBarrage = [], n.staticBarrageST = null, n.runST = 0, n.video = r, n.scroxtVideo = document.querySelector(n.video), n.dataTime = n.quickSort(i), console.log(n.dataTime), n.tempDataTime = JSON.parse(JSON.stringify(n.dataTime)), n.lineHeight = 28, n.videoWidth = parseInt(Object(a.a)(n.video, 'width')), n.MAX_LINE = ~~(parseInt(Object(a.a)(n.video, 'height')) / n.lineHeight), n.MAX_NUM = 50, n.distance = -5, n.colorFont = ['#ffff38', '#c80115', '#189add'], n.createStyle(), n.startRun(), n } return c(e, t), e.prototype.quickSort = function (t) { if (t.length <= 1) return t; for (var e = t.splice(Math.floor(t.length / 2), 1)[0], r = [], i = [], n = 0, a = t.length; n < a; n++)t[n].time < e.time ? r.push(t[n]) : i.push(t[n]); return this.quickSort(r).concat(e, this.quickSort(i)) }, e.prototype.createStyle = function () { Object(s.a)('\n            .multi-barrage-line{\n              position: absolute;\n              display: inline-block;\n              top: 0;\n              user-select:none;\n              white-space: pre;\n              color: #fff;\n              font-size: 25px;\n              font-family:SimHei, "Microsoft JhengHei", Arial, Helvetica, sans-serif;\n              font-weight:bold;\n              line-height: 1.125;\n              text-shadow:rgb(0, 0, 0) 1px 0px 1px, rgb(0, 0, 0) 0px 1px 1px, rgb(0, 0, 0) 0px -1px 1px, rgb(0, 0, 0) -1px 0px 1px;\n              transition:-webkit-transform 0s linear;\n              z-index: 1;\n              pointer-events: none;\n            }\n            .static-barrage-line{\n              position: absolute;\n              left: 50%;\n              transform:translateX(-50%);\n              -webkit-transform:translateX(-50%);\n              top: 0;\n              z-index: 2;\n            }\n        ') }, e.prototype.startRun = function () { var t = this.scroxtVideo.className; this.scroxtVideo.className = t.indexOf('scroxt-video') > -1 ? t : t + ' scroxt-video', this.timeUpdate() }, e.prototype.play = function () { this.scroxtVideo.paused && (this.scroxtVideo.play(), this.intervalRun()) }, e.prototype.stop = function () { this.scroxtVideo.paused || (this.scroxtVideo.pause(), this.intervalStop()) }, e.prototype.restart = function () { this.readyShowBarrage = [], this.tempDataTime = JSON.parse(JSON.stringify(this.dataTime)), this.scroxtVideo.currentTime = 0, this.barrageWrap.forEach(function (t, e) { var r = t.element.parentNode; r && r.removeChild(t.element) }), this.barrageWrap = [] }, e.prototype.moveInterval = function (t) { void 0 === t && (t = 0), this.readyShowBarrage = [], this.tempDataTime = JSON.parse(JSON.stringify(this.dataTime)), this.scroxtVideo.currentTime += t, this.barrageWrap.forEach(function (t, e) { var r = t.element.parentNode; r && r.removeChild(t.element) }), this.barrageWrap = [] }, e.prototype.timeUpdate = function () { this.scroxtVideo.addEventListener('timeupdate', function () { this.distribution(this.scroxtVideo.currentTime) }.bind(this)) }, e.prototype.distribution = function (t) { for (var e = this.tempDataTime.length; e !== 0 && this.tempDataTime[0].time < t;) this.tempDataTime[0].time >= t - 2 && this.readyShowBarrage.push(this.tempDataTime[0].data), this.tempDataTime.shift(), e = this.tempDataTime.length }, e.prototype.createBarrage = function () { var t = this.readyShowBarrage.length; if (t && !(this.barrageWrap.length > this.MAX_NUM)) for (var e = 0; e < t; e++) { if (e > this.MAX_LINE) { t > 20 && !this.staticBarrageST && this.createStaticBarrage(this.readyShowBarrage.splice(0, this.MAX_LINE)); break } var r = e % this.MAX_LINE; var i = document.querySelectorAll("[data-line='" + r + "']"); var n = i.length; var a = void 0; if (n > 0) { a = i[n - 1]; var o = +a.getAttribute('data-width'); var s = +a.getAttribute('data-move'); if (Math.abs(s) + o > this.videoWidth) continue } var c = this.readyShowBarrage.shift(); var h = Math.floor(1e3 * Math.random()) + +new Date() + e; var p = e % 2 == 0 ? 10 : 0; var l = document.createElement('div'); l.className = 'multi-barrage-line'; var u = document.createTextNode('' + c); l.appendChild(u), this.scroxtVideo.parentNode.appendChild(l); var d = parseInt(window.getComputedStyle(l, null).getPropertyValue('width')); var f = d / 600 >= 0.5 ? 0.5 : d / 600; var m = '#fff'; f === 0.5 && (m = this.colorFont[~~(Math.random() * this.colorFont.length)]), this.barrageWrap.push({element: l, scroxt: h, line: r, move: this.videoWidth + p + 10, width: d, distance: f, color: m}) } }, e.prototype.createStaticBarrage = function (t) { for (var e = this, r = 0, i = t.length; r < i; r++)!(function (r, i) { var n = r % e.MAX_LINE; var a = document.createElement('div'); a.className = 'multi-barrage-line static-barrage-line', a.style.top = n * e.lineHeight + 'px', a.style.color = e.colorFont[~~(Math.random() * e.colorFont.length)]; var o = document.createTextNode('' + t[r]); a.appendChild(o), e.staticBarrageST = setTimeout(function () { this.staticBarrageST = null, this.scroxtVideo.parentNode.removeChild(a) }.bind(e), 3e3), e.scroxtVideo.parentNode.appendChild(a) }(r)) }, e.prototype.moveLine = function () { for (var t = 0; t < this.barrageWrap.length; t++) { var e = this.barrageWrap[t]; var r = e.element; var i = (e.scroxt, e.line); var n = e.move; var a = e.width; var o = e.distance; var s = e.color; if (n <= -a) { this.barrageWrap.splice(t, 1), t--; var c = r.parentNode; c && c.removeChild(r) } else { var h = n + this.distance * o + this.distance / 10; this.barrageWrap[t].move = h, r.style.cssText = 'color:' + s + ';transform:translate3d(' + h + 'px,' + i * this.lineHeight + 'px,0);' } } }, e.prototype.intervalRun = function () { this.runST = Object(i.a)(function () { this.createBarrage(), this.moveLine(), this.intervalRun() }.bind(this)) }, e.prototype.intervalStop = function () { Object(n.a)(this.runST) }, e }(o.a)); e.a = h }, function (t, e, r) { 'use strict'; var i = (function () { function t () { this.events = {} } return t.prototype.on = function (t, e) { this.events[t] ? this.events[t].push(e) : this.events[t] = [e] }, t.prototype.off = function (t, e) { this.events[t].splice(this.events[t].indexOf(e), 1) }, t.prototype.empty = function (t) { this.events[t] = [] }, t.prototype.triggle = function (t) { this.events[t].forEach(function (t) { t() }) }, t }()); e.a = i }, function (t, e, r) { 'use strict'; var i = r(2); var n = r(3); var a = r(0); var o = r(1); var s = (function () { function t (t) { var e = t.target; var r = t.strongLock; var n = void 0 !== r && r; this.barrage = [], this.selfBarrage = [], this.barrageWrap = {}, this.MAX_LINE = 4, this.lineHeight = 28, this.sumLine = 0, this.lineGap = 10, this.runST = 0, this.targetElement = document.querySelector(e), this.strongLock = n, this.TARGET_WIDTH = parseInt(Object(i.a)(this.targetElement, 'width')), this.MAX_LINE = ~~(parseInt(Object(i.a)(this.targetElement, 'height')) / this.lineHeight), this.gear = -5, this.LINE_LIMIT = 300, this.startRun() } return t.prototype.startRun = function () { this.createStyle(), this.intervalRun() }, t.prototype.createStyle = function () { Object(n.a)('\n            .multi-barrage-line{\n              position: absolute;\n              display: inline-block;\n              top: 0;\n              user-select:none;\n              white-space: pre;\n              color: #fff;\n              font-size: 25px;\n              font-family:SimHei, "Microsoft JhengHei", Arial, Helvetica, sans-serif;\n              font-weight:bold;\n              line-height: 1.125;\n              text-shadow:rgb(0, 0, 0) 1px 0px 1px, rgb(0, 0, 0) 0px 1px 1px, rgb(0, 0, 0) 0px -1px 1px, rgb(0, 0, 0) -1px 0px 1px;\n              transition:-webkit-transform 0s linear;\n              z-index: 1;\n              pointer-events: none;\n            }\n        ') }, t.prototype.addBarrage = function (t, e) { void 0 === e && (e = !1), e ? this.selfBarrage.push(t) : this.barrage.push(t) }, t.prototype.createBarrage = function () { for (var t = 0, e = this.barrage.length; e > 0 && t < this.MAX_LINE; t++) { var r = void 0; var i = t % this.MAX_LINE; if (this.selfBarrage.length > 0)r = this.selfBarrage.shift(); else { if (this.strongLock && this.sumLine > 65) { this.barrage = []; break } if (this.barrageWrap[i]) { var n = this.barrageWrap[i].length; if (n > 0) { var a = this.barrageWrap[i][n - 1]; if (a.move + a.width > this.TARGET_WIDTH - this.lineGap) continue } }r = this.barrage.shift(), e-- } this.generateBarrage(i, r) } }, t.prototype.generateBarrage = function (t, e) { var r = document.createElement('div'); r.className = 'multi-barrage-line'; var n = document.createTextNode(e); r.appendChild(n), r.style.opacity = '0', this.targetElement.appendChild(r); var a = parseInt(Object(i.a)(r, 'width')); var o = a / 600 >= 0.5 ? 0.5 : a / 600; this.barrageWrap[t] ? this.barrageWrap[t].push({element: r, line: t, move: this.TARGET_WIDTH, width: a, speed: o}) : this.barrageWrap[t] = [{element: r, line: t, move: this.TARGET_WIDTH, width: a, speed: o}] }, t.prototype.moveLine = function () { this.sumLine = 0; for (var t in this.barrageWrap) { var e = this.barrageWrap[t]; this.sumLine += e.length; for (var r = 0; r < e.length; r++) { var i = e[r]; var n = i.element; var a = i.line; var o = i.move; var s = i.width; var c = i.speed; if (o <= -s)e.splice(r, 1), r--, this.targetElement.removeChild(n); else { var h = o + this.gear * c + this.gear / 10; i.move = h, n.style.cssText = 'transform:translate3d(' + h + 'px,' + a * this.lineHeight + 'px,0);opacity="1";' } } } }, t.prototype.intervalRun = function () { this.runST = Object(a.a)(function () { this.moveLine(), this.createBarrage(), this.intervalRun() }.bind(this)) }, t.prototype.intervalStop = function () { Object(o.a)(this.runST) }, t }()); e.a = s }])) }))
